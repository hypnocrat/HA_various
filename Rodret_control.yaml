blueprint:
  name: IKEA RODRET Switch - Dual Light Control (Zigbee2MQTT Only)
  description: >
    Control two separate lights with an IKEA RODRET switch using Zigbee2MQTT.
    - Press "on" to toggle Light 1.
    - Press "off" to toggle Light 2.
    - Hold "on" to increase brightness of both lights.
    - Hold "off" to decrease brightness of both lights.
    This blueprint ONLY works with devices added via the Zigbee2MQTT integration.
  domain: automation
  input:
    rodret_switch:
      name: RODRET Switch
      description: "Select your IKEA RODRET switch that is managed by Zigbee2MQTT."
      selector:
        device:
          filter:
            - integration: mqtt
    light_1:
      name: Light 1 (On Button)
      description: "The light controlled by the 'on' button press."
      selector:
        entity:
          domain: light
    light_2:
      name: Light 2 (Off Button)
      description: "The light controlled by the 'off' button press."
      selector:
        entity:
          domain: light
    brightness_step:
      name: Brightness Step
      description: "The amount to increase or decrease brightness when holding a button."
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

# Zigbee2MQTT Triggers Only
trigger:
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_short_press
    subtype: button_1
    id: press_on
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_short_press
    subtype: button_2
    id: press_off
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_long_press
    subtype: button_1
    id: hold_on
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_long_release
    subtype: button_1
    id: release_on
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_long_press
    subtype: button_2
    id: hold_off
  - platform: device
    device_id: !input rodret_switch
    domain: mqtt
    type: button_long_release
    subtype: button_2
    id: release_off

action:
  - choose:
      # --- Press "On" ---
      - conditions:
          - condition: trigger
            id: press_on
        sequence:
          - service: light.toggle
            target:
              entity_id: !input light_1

      # --- Press "Off" ---
      - conditions:
          - condition: trigger
            id: press_off
        sequence:
          - service: light.toggle
            target:
              entity_id: !input light_2

      # --- Hold "On" (Increase Brightness) ---
      - conditions:
          - condition: trigger
            id: hold_on
        sequence:
          - repeat:
              until:
                - condition: trigger
                  id:
                    - release_on
              sequence:
                - service: light.turn_on
                  target:
                    entity_id:
                      - !input light_1
                      - !input light_2
                  data:
                    brightness_step_pct: !input brightness_step
                - delay: 0.5

      # --- Hold "Off" (Decrease Brightness) ---
      - conditions:
          - condition: trigger
            id: hold_off
        sequence:
          - repeat:
              until:
                - condition: trigger
                  id:
                    - release_off
              sequence:
                - service: light.turn_on
                  target:
                    entity_id:
                      - !input light_1
                      - !input light_2
                  data:
                    brightness_step_pct: -!input brightness_step
                - delay: 0.5

mode: restart
